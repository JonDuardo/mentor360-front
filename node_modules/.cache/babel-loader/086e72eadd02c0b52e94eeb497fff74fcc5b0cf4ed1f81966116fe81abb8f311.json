{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\joaoe\\\\OneDrive\\\\007 - Global Trainer\\\\Mentor 360\\\\Mentor 360 - Front End\\\\mentor360-front\\\\src\\\\pages\\\\ChatPage.jsx\",\n  _s = $RefreshSig$();\n// src/pages/ChatPage.jsx\nimport { useState, useRef, useEffect } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport ChatBubble from \"../components/ChatBubble\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst alanAvatar = \"https://ui-avatars.com/api/?name=Alan+Fernandes&background=0AE68A&color=fff\";\n\n// Telinha de sessão encerrada\nfunction SessionEnded({\n  onNovoChat,\n  onVerSessoes\n}) {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col items-center justify-center h-[70vh] bg-white rounded-2xl shadow-lg mt-8 max-w-2xl mx-auto text-center p-8\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"text-2xl font-semibold mb-2\",\n      children: \"Sess\\xE3o encerrada \\u2705\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 12,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"text-gray-600 mb-6\",\n      children: \"Obrigado pela conversa! Quer come\\xE7ar um novo chat agora ou rever o hist\\xF3rico?\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 13,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex gap-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onNovoChat,\n        className: \"bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl px-4 py-2 font-medium transition\",\n        children: \"Novo chat\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 17,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onVerSessoes,\n        className: \"bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl px-4 py-2 font-medium transition\",\n        children: \"Ver sess\\xF5es\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 23,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 16,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-6 text-sm text-gray-400\",\n      children: \"See you later, alligator! \\uD83D\\uDC0A\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 30,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 11,\n    columnNumber: 5\n  }, this);\n}\n_c = SessionEnded;\nexport default function ChatPage(props) {\n  _s();\n  const navigate = useNavigate();\n  const {\n    sessaoId\n  } = useParams();\n\n  // Prioriza: URL > props > localStorage\n  const user_id = props.user_id || localStorage.getItem(\"user_id\");\n  const user_name = props.user_name || localStorage.getItem(\"user_name\") || \"Você\";\n  const sessao_id = sessaoId || props.sessao_id || localStorage.getItem(\"sessao_id\");\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [erro, setErro] = useState(\"\");\n  const [digitando, setDigitando] = useState(false);\n  const [ended, setEnded] = useState(false); // <<< NOVO: estado de sessão encerrada\n  const endRef = useRef(null);\n\n  // Guarda sessao_id atual\n  useEffect(() => {\n    if (sessao_id) {\n      localStorage.setItem(\"sessao_id\", sessao_id);\n    }\n  }, [sessao_id]);\n\n  // Scroll\n  useEffect(() => {\n    var _endRef$current;\n    (_endRef$current = endRef.current) === null || _endRef$current === void 0 ? void 0 : _endRef$current.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages, digitando]);\n\n  // Carrega histórico\n  useEffect(() => {\n    if (!sessao_id) return;\n    setLoading(true);\n    fetch(`http://localhost:3000/historico/${sessao_id}`).then(res => res.json()).then(data => {\n      if (Array.isArray(data.mensagens)) {\n        setMessages(data.mensagens.map(msg => ({\n          name: msg.origem === \"usuario\" ? user_name : \"Alan\",\n          text: msg.texto_mensagem,\n          isUser: msg.origem === \"usuario\",\n          avatar: msg.origem === \"usuario\" ? undefined : alanAvatar\n        })));\n      } else {\n        setMessages([]);\n      }\n    }).catch(() => setErro(\"Erro ao carregar mensagens\")).finally(() => setLoading(false));\n  }, [sessao_id, user_name]);\n\n  // Enviar mensagem\n  const sendMessage = async () => {\n    if (ended) return; // <<< se sessão encerrada, não envia\n    if (input.trim() === \"\" || !sessao_id || !user_id) return;\n    setErro(\"\");\n    setMessages(msgs => [...msgs, {\n      name: user_name,\n      text: input,\n      isUser: true\n    }]);\n    const userText = input;\n    setInput(\"\");\n    setDigitando(true);\n    try {\n      // Salva mensagem do usuário\n      await fetch(\"http://localhost:3000/mensagem\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          sessao_id,\n          user_id,\n          texto_mensagem: userText,\n          origem: \"usuario\"\n        })\n      });\n\n      // Chama IA\n      const resp = await fetch(\"http://localhost:3000/ia\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          sessao_id,\n          user_id,\n          mensagem: userText\n        })\n      });\n      const data = await resp.json();\n      if (resp.ok && data.resposta) {\n        setMessages(msgs => [...msgs, {\n          name: \"Alan\",\n          text: data.resposta,\n          isUser: false,\n          avatar: alanAvatar\n        }]);\n      } else {\n        setMessages(msgs => [...msgs, {\n          name: \"Alan\",\n          text: \"Ocorreu um erro ao responder. Tente novamente.\",\n          isUser: false,\n          avatar: alanAvatar\n        }]);\n      }\n    } catch (err) {\n      setMessages(msgs => [...msgs, {\n        name: \"Alan\",\n        text: \"Erro ao conectar com o servidor.\",\n        isUser: false,\n        avatar: alanAvatar\n      }]);\n    } finally {\n      setDigitando(false);\n    }\n  };\n\n  // <<< NOVO: finalizar sessão atual (chama backend e troca UI)\n  const handleFinalizarSessao = async () => {\n    if (!sessao_id) return;\n    try {\n      const resp = await fetch(\"http://localhost:3000/finalizar-sessao\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          sessao_id\n        })\n      });\n      if (!resp.ok) {\n        const j = await resp.json().catch(() => ({}));\n        throw new Error(j.error || \"Falha ao finalizar sessão\");\n      }\n      // Marca UI como encerrada\n      setEnded(true);\n    } catch (e) {\n      setErro(e.message || \"Erro ao finalizar sessão\");\n    }\n  };\n\n  // <<< NOVO: criar nova sessão em branco e navegar\n  const handleNovoChat = async () => {\n    try {\n      var _j$sessao;\n      const uid = user_id || localStorage.getItem(\"user_id\");\n      if (!uid) throw new Error(\"Sem user_id\");\n      const r = await fetch(\"http://localhost:3000/sessao\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        // pode ser uma mensagem neutra; o backend usa isso como resumo inicial\n        body: JSON.stringify({\n          user_id: uid,\n          mensagem: \"Nova sessão iniciada\"\n        })\n      });\n      const j = await r.json();\n      if (!r.ok || !(j !== null && j !== void 0 && (_j$sessao = j.sessao) !== null && _j$sessao !== void 0 && _j$sessao.id)) throw new Error(j.erro || \"Não foi possível criar nova sessão\");\n\n      // salva e navega\n      localStorage.setItem(\"sessao_id\", j.sessao.id);\n      setEnded(false);\n      setMessages([]);\n      navigate(`/chat/${j.sessao.id}`);\n    } catch (e) {\n      setErro(e.message || \"Erro ao criar nova sessão\");\n    }\n  };\n\n  // <<< NOVO: atalho para ver sessões\n  const handleVerSessoes = () => {\n    navigate(\"/sessoes\");\n  };\n\n  // Se encerrou, renderiza a telinha de fim\n  if (ended) {\n    return /*#__PURE__*/_jsxDEV(SessionEnded, {\n      onNovoChat: handleNovoChat,\n      onVerSessoes: handleVerSessoes\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 12\n    }, this);\n  }\n\n  // UI normal do chat\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col h-[70vh] bg-white rounded-2xl shadow-lg mt-8 max-w-2xl mx-auto\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 overflow-y-auto p-6\",\n      children: [loading && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-gray-400\",\n        children: \"Carregando...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 21\n      }, this), messages.map((msg, idx) => /*#__PURE__*/_jsxDEV(ChatBubble, {\n        ...msg\n      }, idx, false, {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 11\n      }, this)), digitando && /*#__PURE__*/_jsxDEV(ChatBubble, {\n        text: \"Alan est\\xE1 digitando...\",\n        isUser: false,\n        name: \"Alan\",\n        avatar: alanAvatar\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: endRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"border-t p-4 flex items-center gap-2\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        className: \"flex-1 border border-emerald-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-400\",\n        placeholder: \"Digite sua mensagem...\",\n        value: input,\n        onChange: e => setInput(e.target.value),\n        onKeyDown: e => e.key === \"Enter\" && sendMessage(),\n        disabled: loading || digitando\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: sendMessage,\n        className: \"bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl px-4 py-2 font-medium transition\",\n        disabled: loading || !input.trim() || digitando,\n        children: \"Enviar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleFinalizarSessao,\n        className: \"ml-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl px-4 py-2 font-medium transition\",\n        disabled: !sessao_id || loading || digitando,\n        title: \"Gera resumo, fecha a sess\\xE3o e mostra op\\xE7\\xF5es\",\n        children: \"Encerrar sess\\xE3o\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 7\n    }, this), erro && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-red-500 text-center\",\n      children: erro\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 16\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 196,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatPage, \"xm6+yR+g9WwfKvvGCwGXJkBUH74=\", false, function () {\n  return [useNavigate, useParams];\n});\n_c2 = ChatPage;\nvar _c, _c2;\n$RefreshReg$(_c, \"SessionEnded\");\n$RefreshReg$(_c2, \"ChatPage\");","map":{"version":3,"names":["useState","useRef","useEffect","useParams","useNavigate","ChatBubble","jsxDEV","_jsxDEV","alanAvatar","SessionEnded","onNovoChat","onVerSessoes","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","_c","ChatPage","props","_s","navigate","sessaoId","user_id","localStorage","getItem","user_name","sessao_id","messages","setMessages","input","setInput","loading","setLoading","erro","setErro","digitando","setDigitando","ended","setEnded","endRef","setItem","_endRef$current","current","scrollIntoView","behavior","fetch","then","res","json","data","Array","isArray","mensagens","map","msg","name","origem","text","texto_mensagem","isUser","avatar","undefined","catch","finally","sendMessage","trim","msgs","userText","method","headers","body","JSON","stringify","resp","mensagem","ok","resposta","err","handleFinalizarSessao","j","Error","error","e","message","handleNovoChat","_j$sessao","uid","r","sessao","id","handleVerSessoes","idx","ref","type","placeholder","value","onChange","target","onKeyDown","key","disabled","title","_c2","$RefreshReg$"],"sources":["C:/Users/joaoe/OneDrive/007 - Global Trainer/Mentor 360/Mentor 360 - Front End/mentor360-front/src/pages/ChatPage.jsx"],"sourcesContent":["// src/pages/ChatPage.jsx\r\nimport { useState, useRef, useEffect } from \"react\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport ChatBubble from \"../components/ChatBubble\";\r\n\r\nconst alanAvatar = \"https://ui-avatars.com/api/?name=Alan+Fernandes&background=0AE68A&color=fff\";\r\n\r\n// Telinha de sessão encerrada\r\nfunction SessionEnded({ onNovoChat, onVerSessoes }) {\r\n  return (\r\n    <div className=\"flex flex-col items-center justify-center h-[70vh] bg-white rounded-2xl shadow-lg mt-8 max-w-2xl mx-auto text-center p-8\">\r\n      <h2 className=\"text-2xl font-semibold mb-2\">Sessão encerrada ✅</h2>\r\n      <p className=\"text-gray-600 mb-6\">\r\n        Obrigado pela conversa! Quer começar um novo chat agora ou rever o histórico?\r\n      </p>\r\n      <div className=\"flex gap-3\">\r\n        <button\r\n          onClick={onNovoChat}\r\n          className=\"bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl px-4 py-2 font-medium transition\"\r\n        >\r\n          Novo chat\r\n        </button>\r\n        <button\r\n          onClick={onVerSessoes}\r\n          className=\"bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl px-4 py-2 font-medium transition\"\r\n        >\r\n          Ver sessões\r\n        </button>\r\n      </div>\r\n      <div className=\"mt-6 text-sm text-gray-400\">See you later, alligator! 🐊</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function ChatPage(props) {\r\n  const navigate = useNavigate();\r\n  const { sessaoId } = useParams();\r\n\r\n  // Prioriza: URL > props > localStorage\r\n  const user_id = props.user_id || localStorage.getItem(\"user_id\");\r\n  const user_name = props.user_name || localStorage.getItem(\"user_name\") || \"Você\";\r\n  const sessao_id = sessaoId || props.sessao_id || localStorage.getItem(\"sessao_id\");\r\n\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [erro, setErro] = useState(\"\");\r\n  const [digitando, setDigitando] = useState(false);\r\n  const [ended, setEnded] = useState(false); // <<< NOVO: estado de sessão encerrada\r\n  const endRef = useRef(null);\r\n\r\n  // Guarda sessao_id atual\r\n  useEffect(() => {\r\n    if (sessao_id) {\r\n      localStorage.setItem(\"sessao_id\", sessao_id);\r\n    }\r\n  }, [sessao_id]);\r\n\r\n  // Scroll\r\n  useEffect(() => {\r\n    endRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages, digitando]);\r\n\r\n  // Carrega histórico\r\n  useEffect(() => {\r\n    if (!sessao_id) return;\r\n    setLoading(true);\r\n    fetch(`http://localhost:3000/historico/${sessao_id}`)\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        if (Array.isArray(data.mensagens)) {\r\n          setMessages(\r\n            data.mensagens.map(msg => ({\r\n              name: msg.origem === \"usuario\" ? user_name : \"Alan\",\r\n              text: msg.texto_mensagem,\r\n              isUser: msg.origem === \"usuario\",\r\n              avatar: msg.origem === \"usuario\" ? undefined : alanAvatar,\r\n            }))\r\n          );\r\n        } else {\r\n          setMessages([]);\r\n        }\r\n      })\r\n      .catch(() => setErro(\"Erro ao carregar mensagens\"))\r\n      .finally(() => setLoading(false));\r\n  }, [sessao_id, user_name]);\r\n\r\n  // Enviar mensagem\r\n  const sendMessage = async () => {\r\n    if (ended) return; // <<< se sessão encerrada, não envia\r\n    if (input.trim() === \"\" || !sessao_id || !user_id) return;\r\n    setErro(\"\");\r\n    setMessages(msgs => [...msgs, { name: user_name, text: input, isUser: true }]);\r\n    const userText = input;\r\n    setInput(\"\");\r\n    setDigitando(true);\r\n\r\n    try {\r\n      // Salva mensagem do usuário\r\n      await fetch(\"http://localhost:3000/mensagem\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          sessao_id,\r\n          user_id,\r\n          texto_mensagem: userText,\r\n          origem: \"usuario\"\r\n        })\r\n      });\r\n\r\n      // Chama IA\r\n      const resp = await fetch(\"http://localhost:3000/ia\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ sessao_id, user_id, mensagem: userText })\r\n      });\r\n      const data = await resp.json();\r\n      if (resp.ok && data.resposta) {\r\n        setMessages(msgs => [\r\n          ...msgs,\r\n          { name: \"Alan\", text: data.resposta, isUser: false, avatar: alanAvatar }\r\n        ]);\r\n      } else {\r\n        setMessages(msgs => [\r\n          ...msgs,\r\n          { name: \"Alan\", text: \"Ocorreu um erro ao responder. Tente novamente.\", isUser: false, avatar: alanAvatar }\r\n        ]);\r\n      }\r\n    } catch (err) {\r\n      setMessages(msgs => [\r\n        ...msgs,\r\n        { name: \"Alan\", text: \"Erro ao conectar com o servidor.\", isUser: false, avatar: alanAvatar }\r\n      ]);\r\n    } finally {\r\n      setDigitando(false);\r\n    }\r\n  };\r\n\r\n  // <<< NOVO: finalizar sessão atual (chama backend e troca UI)\r\n  const handleFinalizarSessao = async () => {\r\n    if (!sessao_id) return;\r\n    try {\r\n      const resp = await fetch(\"http://localhost:3000/finalizar-sessao\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ sessao_id })\r\n      });\r\n      if (!resp.ok) {\r\n        const j = await resp.json().catch(() => ({}));\r\n        throw new Error(j.error || \"Falha ao finalizar sessão\");\r\n      }\r\n      // Marca UI como encerrada\r\n      setEnded(true);\r\n    } catch (e) {\r\n      setErro(e.message || \"Erro ao finalizar sessão\");\r\n    }\r\n  };\r\n\r\n  // <<< NOVO: criar nova sessão em branco e navegar\r\n  const handleNovoChat = async () => {\r\n    try {\r\n      const uid = user_id || localStorage.getItem(\"user_id\");\r\n      if (!uid) throw new Error(\"Sem user_id\");\r\n\r\n      const r = await fetch(\"http://localhost:3000/sessao\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        // pode ser uma mensagem neutra; o backend usa isso como resumo inicial\r\n        body: JSON.stringify({ user_id: uid, mensagem: \"Nova sessão iniciada\" })\r\n      });\r\n      const j = await r.json();\r\n      if (!r.ok || !j?.sessao?.id) throw new Error(j.erro || \"Não foi possível criar nova sessão\");\r\n\r\n      // salva e navega\r\n      localStorage.setItem(\"sessao_id\", j.sessao.id);\r\n      setEnded(false);\r\n      setMessages([]);\r\n      navigate(`/chat/${j.sessao.id}`);\r\n    } catch (e) {\r\n      setErro(e.message || \"Erro ao criar nova sessão\");\r\n    }\r\n  };\r\n\r\n  // <<< NOVO: atalho para ver sessões\r\n  const handleVerSessoes = () => {\r\n    navigate(\"/sessoes\");\r\n  };\r\n\r\n  // Se encerrou, renderiza a telinha de fim\r\n  if (ended) {\r\n    return <SessionEnded onNovoChat={handleNovoChat} onVerSessoes={handleVerSessoes} />;\r\n  }\r\n\r\n  // UI normal do chat\r\n  return (\r\n    <div className=\"flex flex-col h-[70vh] bg-white rounded-2xl shadow-lg mt-8 max-w-2xl mx-auto\">\r\n      {/* Área de mensagens */}\r\n      <div className=\"flex-1 overflow-y-auto p-6\">\r\n        {loading && <div className=\"text-gray-400\">Carregando...</div>}\r\n        {messages.map((msg, idx) => (\r\n          <ChatBubble key={idx} {...msg} />\r\n        ))}\r\n        {digitando && (\r\n          <ChatBubble\r\n            text=\"Alan está digitando...\"\r\n            isUser={false}\r\n            name=\"Alan\"\r\n            avatar={alanAvatar}\r\n          />\r\n        )}\r\n        <div ref={endRef} />\r\n      </div>\r\n\r\n      {/* Rodapé: input e botões */}\r\n      <div className=\"border-t p-4 flex items-center gap-2\">\r\n        <input\r\n          type=\"text\"\r\n          className=\"flex-1 border border-emerald-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-400\"\r\n          placeholder=\"Digite sua mensagem...\"\r\n          value={input}\r\n          onChange={e => setInput(e.target.value)}\r\n          onKeyDown={e => e.key === \"Enter\" && sendMessage()}\r\n          disabled={loading || digitando}\r\n        />\r\n        <button\r\n          onClick={sendMessage}\r\n          className=\"bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl px-4 py-2 font-medium transition\"\r\n          disabled={loading || !input.trim() || digitando}\r\n        >\r\n          Enviar\r\n        </button>\r\n\r\n        {/* <<< NOVO: botão de encerrar sessão */}\r\n        <button\r\n          onClick={handleFinalizarSessao}\r\n          className=\"ml-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl px-4 py-2 font-medium transition\"\r\n          disabled={!sessao_id || loading || digitando}\r\n          title=\"Gera resumo, fecha a sessão e mostra opções\"\r\n        >\r\n          Encerrar sessão\r\n        </button>\r\n      </div>\r\n\r\n      {erro && <div className=\"text-red-500 text-center\">{erro}</div>}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}