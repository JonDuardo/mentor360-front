{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\joaoe\\\\OneDrive\\\\007 - Global Trainer\\\\Mentor 360\\\\Mentor 360 - Front End\\\\mentor360-front\\\\src\\\\pages\\\\ChatPage.jsx\",\n  _s = $RefreshSig$();\nimport { useState, useRef, useEffect } from \"react\";\nimport ChatBubble from \"../components/ChatBubble\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst alanAvatar = \"https://ui-avatars.com/api/?name=Alan+Fernandes&background=0AE68A&color=fff\"; // Placeholder\n\nexport default function ChatPage({\n  sessao_id,\n  user_id,\n  user_name\n}) {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [erro, setErro] = useState(\"\");\n  const endRef = useRef(null);\n\n  // Auto-scroll\n  useEffect(() => {\n    var _endRef$current;\n    (_endRef$current = endRef.current) === null || _endRef$current === void 0 ? void 0 : _endRef$current.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages]);\n\n  // Busca histórico real do backend ao carregar/mudar sessão\n  useEffect(() => {\n    if (!sessao_id) return;\n    setLoading(true);\n    fetch(`http://localhost:3000/historico/${sessao_id}`).then(res => res.json()).then(data => {\n      if (Array.isArray(data.mensagens)) {\n        setMessages(data.mensagens.map(msg => ({\n          name: msg.origem === \"usuario\" ? user_name : \"Alan\",\n          text: msg.texto_mensagem,\n          isUser: msg.origem === \"usuario\",\n          avatar: msg.origem === \"usuario\" ? undefined : alanAvatar\n        })));\n      } else {\n        setMessages([]);\n      }\n    }).catch(err => setErro(\"Erro ao carregar mensagens\")).finally(() => setLoading(false));\n  }, [sessao_id, user_name]);\n\n  // Função para enviar mensagem (POST /mensagem)\n  const sendMessage = async () => {\n    if (input.trim() === \"\" || !sessao_id || !user_id) return;\n    setLoading(true);\n    setErro(\"\");\n    try {\n      const res = await fetch(\"http://localhost:3000/mensagem\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          sessao_id,\n          user_id,\n          texto_mensagem: input,\n          origem: \"usuario\"\n        })\n      });\n      const data = await res.json();\n      if (!res.ok) throw new Error(data.error || \"Erro ao enviar mensagem\");\n      setInput(\"\");\n      // Recarrega histórico (atualizado)\n      const resHist = await fetch(`http://localhost:3000/historico/${sessao_id}`);\n      const dataHist = await resHist.json();\n      if (Array.isArray(dataHist.mensagens)) {\n        setMessages(dataHist.mensagens.map(msg => ({\n          name: msg.origem === \"usuario\" ? user_name : \"Alan\",\n          text: msg.texto_mensagem,\n          isUser: msg.origem === \"usuario\",\n          avatar: msg.origem === \"usuario\" ? undefined : alanAvatar\n        })));\n      }\n    } catch (err) {\n      setErro(err.message || \"Erro ao enviar mensagem\");\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col h-[70vh] bg-white rounded-2xl shadow-lg mt-8 max-w-2xl mx-auto\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 overflow-y-auto p-6\",\n      children: [loading && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-gray-400\",\n        children: \"Carregando...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 21\n      }, this), messages.map((msg, idx) => /*#__PURE__*/_jsxDEV(ChatBubble, {\n        ...msg\n      }, idx, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 11\n      }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: endRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"border-t p-4 flex items-center gap-2\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        className: \"flex-1 border border-emerald-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-400\",\n        placeholder: \"Digite sua mensagem...\",\n        value: input,\n        onChange: e => setInput(e.target.value),\n        onKeyDown: e => e.key === \"Enter\" && sendMessage(),\n        disabled: loading\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: sendMessage,\n        className: \"bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl px-4 py-2 font-medium transition\",\n        disabled: loading || !input.trim(),\n        children: \"Enviar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }, this), erro && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-red-500 text-center\",\n      children: erro\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 16\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 82,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatPage, \"4fN9QAv6u7YOKyglNosTNGJW9BM=\");\n_c = ChatPage;\nvar _c;\n$RefreshReg$(_c, \"ChatPage\");","map":{"version":3,"names":["useState","useRef","useEffect","ChatBubble","jsxDEV","_jsxDEV","alanAvatar","ChatPage","sessao_id","user_id","user_name","_s","messages","setMessages","input","setInput","loading","setLoading","erro","setErro","endRef","_endRef$current","current","scrollIntoView","behavior","fetch","then","res","json","data","Array","isArray","mensagens","map","msg","name","origem","text","texto_mensagem","isUser","avatar","undefined","catch","err","finally","sendMessage","trim","method","headers","body","JSON","stringify","ok","Error","error","resHist","dataHist","message","className","children","fileName","_jsxFileName","lineNumber","columnNumber","idx","ref","type","placeholder","value","onChange","e","target","onKeyDown","key","disabled","onClick","_c","$RefreshReg$"],"sources":["C:/Users/joaoe/OneDrive/007 - Global Trainer/Mentor 360/Mentor 360 - Front End/mentor360-front/src/pages/ChatPage.jsx"],"sourcesContent":["import { useState, useRef, useEffect } from \"react\";\r\nimport ChatBubble from \"../components/ChatBubble\";\r\n\r\nconst alanAvatar = \"https://ui-avatars.com/api/?name=Alan+Fernandes&background=0AE68A&color=fff\"; // Placeholder\r\n\r\nexport default function ChatPage({ sessao_id, user_id, user_name }) {\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [erro, setErro] = useState(\"\");\r\n  const endRef = useRef(null);\r\n\r\n  // Auto-scroll\r\n  useEffect(() => {\r\n    endRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  // Busca histórico real do backend ao carregar/mudar sessão\r\n  useEffect(() => {\r\n    if (!sessao_id) return;\r\n    setLoading(true);\r\n    fetch(`http://localhost:3000/historico/${sessao_id}`)\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        if (Array.isArray(data.mensagens)) {\r\n          setMessages(\r\n            data.mensagens.map(msg => ({\r\n              name: msg.origem === \"usuario\" ? user_name : \"Alan\",\r\n              text: msg.texto_mensagem,\r\n              isUser: msg.origem === \"usuario\",\r\n              avatar: msg.origem === \"usuario\" ? undefined : alanAvatar,\r\n            }))\r\n          );\r\n        } else {\r\n          setMessages([]);\r\n        }\r\n      })\r\n      .catch(err => setErro(\"Erro ao carregar mensagens\"))\r\n      .finally(() => setLoading(false));\r\n  }, [sessao_id, user_name]);\r\n\r\n  // Função para enviar mensagem (POST /mensagem)\r\n  const sendMessage = async () => {\r\n    if (input.trim() === \"\" || !sessao_id || !user_id) return;\r\n    setLoading(true);\r\n    setErro(\"\");\r\n    try {\r\n      const res = await fetch(\"http://localhost:3000/mensagem\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          sessao_id,\r\n          user_id,\r\n          texto_mensagem: input,\r\n          origem: \"usuario\"\r\n        })\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data.error || \"Erro ao enviar mensagem\");\r\n      setInput(\"\");\r\n      // Recarrega histórico (atualizado)\r\n      const resHist = await fetch(`http://localhost:3000/historico/${sessao_id}`);\r\n      const dataHist = await resHist.json();\r\n      if (Array.isArray(dataHist.mensagens)) {\r\n        setMessages(\r\n          dataHist.mensagens.map(msg => ({\r\n            name: msg.origem === \"usuario\" ? user_name : \"Alan\",\r\n            text: msg.texto_mensagem,\r\n            isUser: msg.origem === \"usuario\",\r\n            avatar: msg.origem === \"usuario\" ? undefined : alanAvatar,\r\n          }))\r\n        );\r\n      }\r\n    } catch (err) {\r\n      setErro(err.message || \"Erro ao enviar mensagem\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-[70vh] bg-white rounded-2xl shadow-lg mt-8 max-w-2xl mx-auto\">\r\n      {/* Área de mensagens */}\r\n      <div className=\"flex-1 overflow-y-auto p-6\">\r\n        {loading && <div className=\"text-gray-400\">Carregando...</div>}\r\n        {messages.map((msg, idx) => (\r\n          <ChatBubble key={idx} {...msg} />\r\n        ))}\r\n        <div ref={endRef} />\r\n      </div>\r\n      {/* Input para nova mensagem */}\r\n      <div className=\"border-t p-4 flex items-center gap-2\">\r\n        <input\r\n          type=\"text\"\r\n          className=\"flex-1 border border-emerald-200 rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-400\"\r\n          placeholder=\"Digite sua mensagem...\"\r\n          value={input}\r\n          onChange={e => setInput(e.target.value)}\r\n          onKeyDown={e => e.key === \"Enter\" && sendMessage()}\r\n          disabled={loading}\r\n        />\r\n        <button\r\n          onClick={sendMessage}\r\n          className=\"bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl px-4 py-2 font-medium transition\"\r\n          disabled={loading || !input.trim()}\r\n        >\r\n          Enviar\r\n        </button>\r\n      </div>\r\n      {erro && <div className=\"text-red-500 text-center\">{erro}</div>}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}